/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, QueryList, Input, ContentChildren, ElementRef, Renderer } from '@angular/core';
import { GridStackOptions } from './../models/grid-stack-options.model';
import { GridStackItemComponent } from './../grid-stack-item/grid-stack-item.component';
var GridStackComponent = /** @class */ (function () {
    function GridStackComponent(el, renderer) {
        this.el = el;
        this.renderer = renderer;
        this.options = new GridStackOptions();
        this.gridStack = null;
        this.grid = null;
        this.defaultOptions = {
            cellHeight: '60px',
            width: 12,
            height: 0,
            animate: true,
            float: false,
            resizable: true
        };
    }
    /**
     * @param {?} item
     * @return {?}
     */
    GridStackComponent.prototype.makeWidget = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        item.jGridRef = this.grid;
        if (item.option != null && item.option.noResize != null && item.option.noResize) {
            return;
        }
        this.grid.resizable(item.nativeElement, true);
        this.grid.move(item.nativeElement, item.option.x, item.option.y);
        this.grid.resize(item.nativeElement, item.option.width, item.option.height);
    };
    /**
     * @param {?} item
     * @return {?}
     */
    GridStackComponent.prototype.updateWidget = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.grid.resizable(item.nativeElement, true);
        this.grid.move(item.nativeElement, item.option.x, item.option.y);
        this.grid.resize(item.nativeElement, item.option.width, item.option.height);
    };
    /**
     * @param {?} item
     * @return {?}
     */
    GridStackComponent.prototype.AddWidget = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        item.jGridRef = this.grid;
        if (item.option != null && item.option.noResize != null && item.option.noResize) {
            return;
        }
        this.grid.makeWidget(item.nativeElement);
        this.grid.resizable(item.nativeElement, true);
        this.grid.move(item.nativeElement, item.option.x, item.option.y);
        this.grid.resize(item.nativeElement, item.option.width, item.option.height);
    };
    /**
     * @param {?} item
     * @return {?}
     */
    GridStackComponent.prototype.RemoveWidget = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.grid.removeWidget(item.nativeElement, false);
    };
    /**
     * @return {?}
     */
    GridStackComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var /** @type {?} */ that = this;
        var /** @type {?} */ nativeElement = this.el.nativeElement;
        if (this.options == null) {
            this.options = new GridStackOptions();
        }
        try {
            for (var _a = tslib_1.__values(Object.keys(this.defaultOptions)), _b = _a.next(); !_b.done; _b = _a.next()) {
                var key = _b.value;
                if (!this.options.hasOwnProperty(key)) {
                    this.options = this.defaultOptions[key];
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.renderer.setElementAttribute(nativeElement, 'data-gs-width', String(this.options.width));
        this.renderer.setElementAttribute(nativeElement, 'data-gs-height', String(this.options.height));
        this.gridStack = jQuery(nativeElement).gridstack(this.options);
        this.grid = this.gridStack.data('gridstack');
        this.gridStack.on('change', function (e, items) {
            _.each(items, function (item) { return _this.widgetChanged(item); });
        });
        // Initialize widgets
        this.items.forEach(function (item) { return that.makeWidget(item); });
        var e_1, _c;
    };
    /**
     * @param {?} change
     * @return {?}
     */
    GridStackComponent.prototype.widgetChanged = /**
     * @param {?} change
     * @return {?}
     */
    function (change) {
        var /** @type {?} */ jWidget = change.el;
        var /** @type {?} */ gridStackItem = this.items.find(function (item) { return item.jWidgetRef !== null ? item.jWidgetRef === jWidget[0] : false; });
        if (!gridStackItem) {
            return;
        }
        gridStackItem.update(change.x, change.y, change.width, change.height);
    };
    GridStackComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-grid-stack',
                    template: "<ng-content></ng-content>\n",
                    styles: [':host { display: block; }']
                },] },
    ];
    /** @nocollapse */
    GridStackComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer }
    ]; };
    GridStackComponent.propDecorators = {
        options: [{ type: Input }],
        items: [{ type: ContentChildren, args: [GridStackItemComponent,] }]
    };
    return GridStackComponent;
}());
export { GridStackComponent };
function GridStackComponent_tsickle_Closure_declarations() {
    /** @type {?} */
    GridStackComponent.prototype.options;
    /** @type {?} */
    GridStackComponent.prototype.items;
    /** @type {?} */
    GridStackComponent.prototype.gridStack;
    /** @type {?} */
    GridStackComponent.prototype.grid;
    /** @type {?} */
    GridStackComponent.prototype.defaultOptions;
    /** @type {?} */
    GridStackComponent.prototype.el;
    /** @type {?} */
    GridStackComponent.prototype.renderer;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1zdGFjay5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZ3JpZC1zdGFjay8iLCJzb3VyY2VzIjpbImxpYi9ncmlkLXN0YWNrL2dyaWQtc3RhY2suY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUNySCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUV4RSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQzs7SUF5QnBGLDRCQUFvQixFQUFjLEVBQVUsUUFBa0I7UUFBMUMsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7dUJBYjNCLElBQUksZ0JBQWdCLEVBQUU7eUJBRWhDLElBQUk7b0JBQ1QsSUFBSTs4QkFDQztZQUN2QixVQUFVLEVBQUUsTUFBTTtZQUNsQixLQUFLLEVBQUUsRUFBRTtZQUNULE1BQU0sRUFBRSxDQUFDO1lBQ1QsT0FBTyxFQUFFLElBQUk7WUFDYixLQUFLLEVBQUUsS0FBSztZQUNaLFNBQVMsRUFBRSxJQUFJO1NBQ2hCO0tBR0E7Ozs7O0lBRU0sdUNBQVU7Ozs7Y0FBQyxJQUE0QjtRQUMxQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDMUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNoRixNQUFNLENBQUM7U0FDUjtRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxD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Q0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBakUsQ0FBaUUsQ0FBQyxDQUFDO1FBQ2pILEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUNuQixNQUFNLENBQUM7U0FDUjtRQUVELGFBQWEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7Z0JBMUY3RSxTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLDZCQUNYO29CQUNDLE1BQU0sRUFBRSxDQUFDLDJCQUEyQixDQUFDO2lCQUN0Qzs7OztnQkFac0QsVUFBVTtnQkFBRSxRQUFROzs7MEJBZXhFLEtBQUs7d0JBQ0gsZUFBZSxTQUFDLHNCQUFzQjs7NkJBaEIzQzs7U0FhYSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFF1ZXJ5TGlzdCwgSW5wdXQsIENvbnRlbnRDaGlsZHJlbiwgRWxlbWVudFJlZiwgUmVuZGVyZXIsIEFmdGVyQ29udGVudEluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdyaWRTdGFja09wdGlvbnMgfSBmcm9tICcuLy4uL21vZGVscy9ncmlkLXN0YWNrLW9wdGlvbnMubW9kZWwnO1xuaW1wb3J0IHsgR3JpZFN0YWNrSXRlbSB9IGZyb20gJy4vLi4vbW9kZWxzL2dyaWQtc3RhY2staXRlbS5tb2RlbCc7XG5pbXBvcnQgeyBHcmlkU3RhY2tJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi8uLi9ncmlkLXN0YWNrLWl0ZW0vZ3JpZC1zdGFjay1pdGVtLmNvbXBvbmVudCc7XG5cbmRlY2xhcmUgdmFyIGpRdWVyeTogYW55O1xuZGVjbGFyZSB2YXIgXzogYW55O1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWdyaWQtc3RhY2snLFxuICB0ZW1wbGF0ZTogYDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbmAsXG4gIHN0eWxlczogWyc6aG9zdCB7IGRpc3BsYXk6IGJsb2NrOyB9J11cbn0pXG5leHBvcnQgY2xhc3MgR3JpZFN0YWNrQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCB7XG5cbiAgQElucHV0KCkgb3B0aW9uczogR3JpZFN0YWNrT3B0aW9ucyA9IG5ldyBHcmlkU3RhY2tPcHRpb25zKCk7XG4gICAgQENvbnRlbnRDaGlsZHJlbihHcmlkU3RhY2tJdGVtQ29tcG9uZW50KSBpdGVtczogUXVlcnlMaXN0PEdyaWRTdGFja0l0ZW1Db21wb25lbnQ+O1xuICAgIHByaXZhdGUgZ3JpZFN0YWNrOiBhbnkgPSBudWxsO1xuICAgIHByaXZhdGUgZ3JpZDogYW55ID0gbnVsbDtcbiAgICBwcml2YXRlIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgY2VsbEhlaWdodDogJzYwcHgnLFxuICAgICAgd2lkdGg6IDEyLFxuICAgICAgaGVpZ2h0OiAwLFxuICAgICAgYW5pbWF0ZTogdHJ1ZSxcbiAgICAgIGZsb2F0OiBmYWxzZSxcbiAgICAgIHJlc2l6YWJsZTogdHJ1ZVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcikge1xuICAgIH1cblxuICAgIHB1YmxpYyBtYWtlV2lkZ2V0KGl0ZW06IEdyaWRTdGFja0l0ZW1Db21wb25lbnQpIHtcbiAgICAgICAgaXRlbS5qR3JpZFJlZiA9IHRoaXMuZ3JpZDtcbiAgICAgICAgaWYgKGl0ZW0ub3B0aW9uICE9IG51bGwgJiYgaXRlbS5vcHRpb24ubm9SZXNpemUgIT0gbnVsbCAmJiBpdGVtLm9wdGlvbi5ub1Jlc2l6ZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JpZC5yZXNpemFibGUoaXRlbS5uYXRpdmVFbGVtZW50LCB0cnVlKTtcbiAgICAgICAgdGhpcy5ncmlkLm1vdmUoaXRlbS5uYXRpdmVFbGVtZW50LCBpdGVtLm9wdGlvbi54LCBpdGVtLm9wdGlvbi55KTtcbiAgICAgICAgdGhpcy5ncmlkLnJlc2l6ZShpdGVtLm5hdGl2ZUVsZW1lbnQsIGl0ZW0ub3B0aW9uLndpZHRoLCBpdGVtLm9wdGlvbi5oZWlnaHQpO1xuICAgIH1cblxuICAgIHB1YmxpYyB1cGRhdGVXaWRnZXQoaXRlbTogR3JpZFN0YWNrSXRlbUNvbXBvbmVudCkge1xuICAgICAgICB0aGlzLmdyaWQucmVzaXphYmxlKGl0ZW0ubmF0aXZlRWxlbWVudCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZ3JpZC5tb3ZlKGl0ZW0ubmF0aXZlRWxlbWVudCwgaXRlbS5vcHRpb24ueCwgaXRlbS5vcHRpb24ueSk7XG4gICAgICAgIHRoaXMuZ3JpZC5yZXNpemUoaXRlbS5uYXRpdmVFbGVtZW50LCBpdGVtLm9wdGlvbi53aWR0aCwgaXRlbS5vcHRpb24uaGVpZ2h0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgQWRkV2lkZ2V0KGl0ZW06IEdyaWRTdGFja0l0ZW1Db21wb25lbnQpIHtcbiAgICAgICAgaXRlbS5qR3JpZFJlZiA9IHRoaXMuZ3JpZDtcbiAgICAgICAgaWYgKGl0ZW0ub3B0aW9uICE9IG51bGwgJiYgaXRlbS5vcHRpb24ubm9SZXNpemUgIT0gbnVsbCAmJiBpdGVtLm9wdGlvbi5ub1Jlc2l6ZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdyaWQubWFrZVdpZGdldChpdGVtLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB0aGlzLmdyaWQucmVzaXphYmxlKGl0ZW0ubmF0aXZlRWxlbWVudCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZ3JpZC5tb3ZlKGl0ZW0ubmF0aXZlRWxlbWVudCwgaXRlbS5vcHRpb24ueCwgaXRlbS5vcHRpb24ueSk7XG4gICAgICAgIHRoaXMuZ3JpZC5yZXNpemUoaXRlbS5uYXRpdmVFbGVtZW50LCBpdGVtLm9wdGlvbi53aWR0aCwgaXRlbS5vcHRpb24uaGVpZ2h0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgUmVtb3ZlV2lkZ2V0KGl0ZW06IEdyaWRTdGFja0l0ZW1Db21wb25lbnQpIHtcbiAgICAgICAgdGhpcy5ncmlkLnJlbW92ZVdpZGdldChpdGVtLm5hdGl2ZUVsZW1lbnQsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuICAgICAgICBjb25zdCBuYXRpdmVFbGVtZW50ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50O1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zID09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBuZXcgR3JpZFN0YWNrT3B0aW9ucygpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy5kZWZhdWx0T3B0aW9ucykpIHtcbiAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLmRlZmF1bHRPcHRpb25zW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRFbGVtZW50QXR0cmlidXRlKG5hdGl2ZUVsZW1lbnQsICdkYXRhLWdzLXdpZHRoJywgU3RyaW5nKHRoaXMub3B0aW9ucy53aWR0aCkpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEVsZW1lbnRBdHRyaWJ1dGUobmF0aXZlRWxlbWVudCwgJ2RhdGEtZ3MtaGVpZ2h0JywgU3RyaW5nKHRoaXMub3B0aW9ucy5oZWlnaHQpKTtcblxuICAgICAgICB0aGlzLmdyaWRTdGFjayA9IGpRdWVyeShuYXRpdmVFbGVtZW50KS5ncmlkc3RhY2sodGhpcy5vcHRpb25zKTtcbiAgICAgICAgdGhpcy5ncmlkID0gdGhpcy5ncmlkU3RhY2suZGF0YSgnZ3JpZHN0YWNrJyk7XG5cbiAgICAgICAgdGhpcy5ncmlkU3RhY2sub24oJ2NoYW5nZScsIChlOiBhbnksIGl0ZW1zOiBhbnkpID0+IHtcbiAgICAgICAgICAgIF8uZWFjaChpdGVtcywgKGl0ZW06IGFueSkgPT4gdGhpcy53aWRnZXRDaGFuZ2VkKGl0ZW0pKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB3aWRnZXRzXG4gICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaChpdGVtID0+IHRoYXQubWFrZVdpZGdldChpdGVtKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB3aWRnZXRDaGFuZ2VkKGNoYW5nZTogR3JpZFN0YWNrSXRlbSk6IHZvaWQge1xuICAgICAgICBjb25zdCBqV2lkZ2V0ID0gY2hhbmdlLmVsO1xuICAgICAgICBjb25zdCBncmlkU3RhY2tJdGVtID0gdGhpcy5pdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5qV2lkZ2V0UmVmICE9PSBudWxsID8gaXRlbS5qV2lkZ2V0UmVmID09PSBqV2lkZ2V0WzBdIDogZmFsc2UpO1xuICAgICAgICBpZiAoIWdyaWRTdGFja0l0ZW0pIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBncmlkU3RhY2tJdGVtLnVwZGF0ZShjaGFuZ2UueCwgY2hhbmdlLnksIGNoYW5nZS53aWR0aCwgY2hhbmdlLmhlaWdodCk7XG4gICAgfVxuXG59XG4iXX0=